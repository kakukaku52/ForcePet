# Django Workbench 功能分析文档

## 一、已实现功能

### 1. 认证模块 (Authentication)
#### ✅ 已完成功能
- **OAuth 2.0 认证**: 支持 Salesforce OAuth 2.0 Web Server Flow，包含 PKCE 安全增强
- **用户名/密码登录**: 支持传统的用户名密码+安全令牌登录方式
- **多环境支持**: Production、Sandbox、Custom Domain
- **会话管理**:
  - 自动刷新令牌
  - 会话信息展示
  - 安全的令牌加密存储
- **用户设置管理**: 个性化配置存储
- **健康检查端点**: 系统状态监控

### 2. 查询模块 (Query)
#### ✅ 已完成功能
- **SOQL 查询界面**:
  - 完整的查询编辑器
  - 查询历史记录
  - 查询结果分页
  - 包含已删除记录选项
- **SOSL 搜索**:
  - 跨对象搜索
  - 搜索历史记录
- **保存查询**: 常用查询保存和管理
- **导出功能**: CSV、JSON 格式导出
- **记录详情查看**: 单条记录的详细信息展示
- **对象和字段元数据**:
  - 获取所有对象列表
  - 获取对象字段信息
- **记录操作**:
  - 更新记录
  - 删除记录

### 3. 数据操作模块 (Data)
#### ✅ 已完成功能
- **插入 (Insert)**: 批量插入记录，支持 CSV 上传
- **更新 (Update)**: 批量更新记录，支持 CSV 上传
- **删除 (Delete)**: 批量删除记录
- **Upsert**: 基于外部 ID 的插入或更新
- **恢复 (Undelete)**: 恢复已删除的记录
- **操作历史**: 所有数据操作的日志记录
- **CSV 处理**: 支持 CSV 文件上传和解析
- **字段信息 API**: 获取对象字段的详细信息

### 4. 元数据模块 (Metadata)
#### ⚠️ 部分实现
- 基础框架已搭建
- 具体功能待实现

### 5. Apex 模块
#### ⚠️ 部分实现
- 基础框架已搭建
- 具体功能待实现

### 6. 批量操作模块 (Bulk)
#### ⚠️ 部分实现
- 基础框架已搭建
- 具体功能待实现

### 7. REST Explorer 模块
#### ⚠️ 部分实现
- 基础框架已搭建
- 具体功能待实现

### 8. Streaming API 模块
#### ⚠️ 部分实现
- 基础框架已搭建
- 具体功能待实现

## 二、待实现功能

### 1. 核心功能完善
- **元数据操作**:
  - [ ] 描述对象 (Describe Objects)
  - [ ] 列出元数据 (List Metadata)
  - [ ] 检索元数据 (Retrieve Metadata)
  - [ ] 部署元数据 (Deploy Metadata)
  - [ ] 元数据依赖树视图：在 Metadata 模块提供全量元数据浏览器，支持按类型筛选与搜索，点击任意组件后以树形结构展示其被引用关系（引用来源、引用深度、依赖路径），并支持导出依赖明细

- **Apex 开发**:
  - [ ] 执行匿名 Apex (Execute Anonymous)
  - [ ] 运行测试类
  - [ ] 查看测试结果
  - [ ] 访问调试日志

- **批量 API**:
  - [ ] Bulk API 2.0 集成
  - [ ] 异步作业管理
  - [ ] 作业进度监控
  - [ ] 批量操作历史

- **REST API Explorer**:
  - [ ] 交互式 API 测试界面
  - [ ] 请求构建器
  - [ ] 响应格式化显示
  - [ ] API 文档集成

- **Streaming API**:
  - [ ] Push Topics 管理
  - [ ] Platform Events 监听
  - [ ] 通用流订阅
  - [ ] 实时数据推送

### 2. 用户体验优化
- [ ] **查询构建器**: 可视化 SOQL 查询构建
- [ ] **数据导入向导**: 步骤式数据导入流程
- [ ] **字段映射工具**: CSV 到 Salesforce 字段的可视化映射
- [ ] **批量编辑器**: 类似 Excel 的批量数据编辑界面
- [ ] **查询优化建议**: SOQL 查询性能分析和优化提示

### 3. 高级功能
- [ ] **多组织管理**: 同时连接和管理多个 Salesforce 组织
- [ ] **数据比较工具**: 不同组织间的数据对比
- [ ] **备份和恢复**: 数据和元数据的备份恢复功能
- [ ] **自动化任务**: 定时执行查询和数据操作
- [ ] **API 限制监控**: 实时 API 使用量监控和警告
- [ ] **自动化资产文档 (Flows)**: 在 Metadata 模块新增 Flow 文档导出工具，解析 Flow 结构/元素/路径，生成含步骤、条件、变量、入口出口等完整说明的 Excel 文档，自动美化格式并排除被调用子流程或 Apex 的内部实现描述

### 4. 协作功能
- [ ] **查询共享**: 团队间共享 SOQL 查询
- [ ] **操作模板**: 创建和共享数据操作模板
- [ ] **审计日志**: 详细的操作审计记录
- [ ] **角色权限**: 细粒度的权限控制

### 5. 集成和扩展
- [ ] **Webhook 集成**: 外部系统集成
- [ ] **插件系统**: 支持自定义插件扩展
- [ ] **API 接口**: 提供 REST API 供外部调用
- [ ] **CLI 工具**: 命令行界面支持

## 三、技术债务和改进项

### 1. 性能优化
- [ ] 实现查询结果缓存
- [ ] 优化大数据集处理
- [ ] 实现异步任务队列（Celery 已配置但未充分利用）
- [ ] 数据库查询优化

### 2. 安全增强
- [ ] 实现双因素认证
- [ ] 增强的会话管理
- [ ] 敏感数据加密
- [ ] SQL 注入防护加强

### 3. 代码质量
- [ ] 单元测试覆盖
- [ ] 集成测试
- [ ] 代码文档完善
- [ ] 错误处理标准化

### 4. 部署和运维
- [ ] Docker 镜像优化
- [ ] Kubernetes 部署配置
- [ ] 监控和告警系统
- [ ] 自动化部署流程

## 四、UI/UX 现状分析

### 当前问题
1. **视觉风格过时**: 使用基础 Bootstrap，缺乏现代感
2. **响应式设计不足**: 移动端体验差
3. **交互体验简陋**: 缺少加载状态、过渡动画
4. **信息架构混乱**: 导航结构不清晰
5. **视觉层次不明**: 重要信息未突出显示
6. **色彩单调**: 缺乏品牌识别度

### 改进建议
1. 采用现代设计系统（如 Material Design 3 或 Fluent Design）
2. 实现深色模式支持
3. 优化移动端响应式布局
4. 添加微交互和动画效果
5. 重新设计信息架构和导航系统
6. 建立统一的设计语言和组件库

## 五、优先级建议

### 高优先级（P0）
1. 完成 Apex 执行功能
2. 实现批量 API 基础功能
3. UI 现代化改造
4. 完善错误处理

### 中优先级（P1）
1. 元数据操作功能
2. REST API Explorer
3. 查询构建器
4. 性能优化

### 低优先级（P2）
1. Streaming API
2. 多组织管理
3. 协作功能
4. 插件系统

## 六、新增功能实现建议

### 1. 元数据依赖追踪（Metadata Dependency Tree）
- **功能入口**: 推荐集成在现有 Metadata 模块首页，增加 “依赖分析” 页签，与 Describe/List Metadata 并列，避免新建模块分散体验。
- **数据来源**: 利用 Tooling API 的 `MetadataComponentDependency` 表联合 `MetadataComponent` / `MetadataComponentRelation` 查询，或在启用 DevHub 的情况下结合 Dependency API；对于未覆盖的类型可退回 `ListMetadata` + `Retrieve` 的 `fullName` 解析。
- **交互设计**: 
  - 左侧使用分类列表（对象、字段、Triggers、Flows、Layouts 等）支持快速筛选。
  - 右侧树形图显示引用链（如 Lightning App → Page → Component → Apex Class），支持上下游切换、深度限制、搜索高亮。
  - 提供导出 JSON/CSV 的能力，便于审计。
- **扩展思路**: 可结合 `metadata/home.html` 既有统计，显示“被引用次数 Top N”与“孤立组件”指标，帮助管理员治理技术债。

### 2. Flow 文档自动生成
- **功能入口**: 建议在 Metadata 模块新建 “Flow 文档导出” 页面，同时于导航中保留入口，确保与其他自动化资产（Process Builder、Workflow）未来扩展一致；若后续建设 Automation 专区，可迁移到新模块。
- **实现方式**:
  - 通过 Tooling API `FlowDefinitionView`/`FlowVersionView` 拿到最新激活版本，再用 Metadata API `retrieve` (Flow) 得到 XML。
  - 解析出 Flow 类型、入口条件、变量、屏幕、决策、循环、调用动作（Apex、Subflow 等），对被调用动作仅记录名称与类型。
  - 使用 `openpyxl` 或 `xlsxwriter` 生成多 Sheet Excel：概览（元数据头信息）、元素清单（步骤顺序、条件、UI 元素）、路径图（来源 → 目标）、错误处理/暂停路径等，配合交替底色、自动列宽与筛选行保证可读性。
  - 支持批量导出多个 Flow，并保留模板供用户自定义字段。
- **进一步增强**: 可叠加 Flow 变更比较（导出前后版本 diff）、签核流程校验（缺失 Label/描述提示）以及“关联资源跳转”（如打开 Flow Builder）。

### 3. 后续可追加的相关能力
- 元数据依赖树可拓展到静态代码分析（扫描 Apex/LWC 中的 API 引用）、测试覆盖率关联。
- Flow 文档功能可结合 CI/CD，在部署前自动生成审计包并推送到 Confluence/SharePoint。
- 两项功能均可借助 Celery 异步化操作，显示进度条并写入 `AsyncJob` 模型，保持界面响应。
