{% extends 'base.html' %}
{% load static %}

{% block title %}Create Salesforce Record{% endblock %}

{% block content %}
<div class="row">
    <div class="col-xl-10 col-lg-11 mx-auto">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h2 class="h4 mb-1">Create Salesforce Record</h2>
                        <p class="text-muted mb-0">选择对象和录入模式，快速创建或导入记录。</p>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-light text-dark">Insert</span>
                    </div>
                </div>

                <div id="insert-messages" aria-live="polite"></div>

                <form id="create-record-form" class="mb-4" autocomplete="off">
                    {% csrf_token %}
                    <div class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label for="sobject-select" class="form-label fw-semibold">Salesforce Object</label>
                            <select id="sobject-select" class="form-select" required>
                                <option value="">请选择对象</option>
                                {% for obj in sobjects %}
                                    <option value="{{ obj.name }}">{{ obj.label }} ({{ obj.name }})</option>
                                {% endfor %}
                            </select>
                            <div class="form-text">加载当前会话可创建的对象列表。</div>
                        </div>
                        <div class="col-md-4">
                            <label for="mode-select" class="form-label fw-semibold">模式</label>
                            <select id="mode-select" class="form-select">
                                <option value="single">单一记录</option>
                                <option value="csv">文件上传</option>
                            </select>
                            <div class="form-text">选择录入单条记录或通过 CSV 文件批量导入。</div>
                        </div>
                        <div class="col-md-4" id="file-upload-group" style="display:none;">
                            <label for="csv-file-input" class="form-label fw-semibold">CSV 文件</label>
                            <input type="file" id="csv-file-input" accept=".csv" class="form-control">
                            <div class="form-text">仅支持包含表头行的 CSV 文件。</div>
                        </div>
                    </div>

                    <div class="mt-3 d-flex justify-content-end">
                        <button type="button" class="btn btn-primary" id="next-button">
                            下一步
                            <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </form>

                <section id="single-record-config" class="d-none">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">单一记录字段</h5>
                        <button type="button" class="btn btn-sm btn-outline-secondary" id="add-single-field">
                            <i class="fas fa-plus me-1"></i>添加字段
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped align-middle" id="single-record-table">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">Field</th>
                                    <th scope="col">Value</th>
                                    <th scope="col">Smart Lookup</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-success" id="single-insert-button">
                            <i class="fas fa-check me-1"></i>Insert
                        </button>
                    </div>
                </section>

                <section id="csv-config" class="d-none">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="mb-0">字段映射</h5>
                        <button type="button" class="btn btn-sm btn-outline-secondary" id="add-csv-mapping">
                            <i class="fas fa-plus me-1"></i>添加映射
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped align-middle" id="csv-mapping-table">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">Field</th>
                                    <th scope="col">CSV Field</th>
                                    <th scope="col">Smart Lookup</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="text-end">
                        <button type="button" class="btn btn-success" id="csv-insert-button">
                            <i class="fas fa-upload me-1"></i>Insert
                        </button>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    window.DATA_FIELDS_ENDPOINT = "{{ fields_api_url }}";
    window.CREATE_RECORD_POST_URL = "{{ insert_post_url }}";
</script>
<script src="{% static 'js/data_create_record.js' %}"></script>
{% endblock %}
